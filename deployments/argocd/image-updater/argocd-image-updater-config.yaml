apiVersion: v1
kind: ConfigMap
metadata:
  name: argocd-image-updater-config
  namespace: argocd
  labels:
    app.kubernetes.io/name: argocd-image-updater-config
    app.kubernetes.io/part-of: argocd-image-updater
data:
  # Log level
  log.level: info

  # Registries configuration
  registries.conf: |
    registries:
      - name: GitHub Container Registry
        api_url: https://ghcr.io
        prefix: ghcr.io
        credentials: pullsecret:argocd/ghcr-credentials
        default: true
        insecure: false
      - name: Docker Hub
        api_url: https://registry-1.docker.io
        prefix: docker.io
        credentials: pullsecret:argocd/dockerhub-credentials
        insecure: false
      - name: AWS ECR
        api_url: https://<account-id>.dkr.ecr.<region>.amazonaws.com
        prefix: <account-id>.dkr.ecr.<region>.amazonaws.com
        credentials: ext:/scripts/ecr-login.sh
        insecure: false

  # Applications configuration
  applications.conf: |
    # Application-specific configurations can be added here

  # Git configuration for write-back
  git.commit-message-template: |
    build: update image {{.AppName}} to {{.NewImage}}
    
    Image: {{.Image}}
    Old tag: {{.OldTag}}
    New tag: {{.NewTag}}
    
    Signed-off-by: ArgoCD Image Updater <argocd-image-updater@example.com>

  # Kustomize configuration
  kustomize.path: /usr/local/bin/kustomize

---
apiVersion: v1
kind: Secret
metadata:
  name: argocd-image-updater-secret
  namespace: argocd
  labels:
    app.kubernetes.io/name: argocd-image-updater-secret
    app.kubernetes.io/part-of: argocd-image-updater
type: Opaque
stringData:
  # Git credentials for write-back
  git.user: argocd-image-updater
  git.email: argocd-image-updater@example.com
  # SSH key or token should be provided via external secrets
  # git.token: <github-token>
